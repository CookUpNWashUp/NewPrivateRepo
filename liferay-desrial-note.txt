ANALYSIS:
- The endpoint /api/spring and /api/liferay are normally restricted to localhost
- Endpoints support  ACLs, no wildcards
- Enterprise proxies are added to the ACL of the endpoint
- Endpoint has blacklist on gadgets, but some can still be used
- Image gadget was first discovered

OBJECTIVES:
- Bypass the whitelist
	-> Not technically bypassable
	-> Bypassable if  proxy to internet is added to whitelist
- Locate the serialization vulnerability
	-> Liferay CE 7.0 GA3
	-> Doesn't block C3P0, DiskFileItem variants, JRMPListener, JRMPClient, and Java DoS gadgets
	-> Typically, this involves using a byte[] from the blacklisted ObjectInputStream to create a new ObjectInputStream that doesnâ€™t have a blacklist.
- Trigger the vuln from outside localhost
	-> Only possible when proxy is whitelisted
TODO:
- Read up on deserialization on Java <DONE>
	-> https://github.com/pwntester/SerialKillerBypassGadgetCollection
	-> Contains a paper
	-> Look for the link of the talk
- Setup tomcat and the liferay portal
	-> Let's use NetBeans
- (Optional) Look for docker
- Look for the api on Github
	-> Record the blacklist implemented
	-> https://github.com/liferay/liferay-portal/commit/584e569add9921646706d6170d9bcfb5c7d68c11
		Can be found at the regex part
	-> https://issues.liferay.com/browse/LPS-64441 serialization vuln found and worked around with whitelisting only localhost
	-> Do I need to learn how to use axis 2 for this ?
	
----- GAMEPLAN -----

TARGETS:
/api/liferay: com.liferay.portal.servlet.TunnelServlet : /portal-impl/src/com/liferay/portal/servlet/TunnelServlet.java
/api/spring: com.liferay.portal.spring.servlet.RemotingServlet : /portal-impl/com/liferay/portal/spring/servlet/RemotingServlet.java
OPTION 1:
- Build payload with SerialKiller
	-> https://mogwailabs.de/blog/2019/03/attacking-java-rmi-services-after-jep-290/ explains JRMI pretty clearly
	-> Wraps it with BeanUtils1 from https://github.com/pwntester/SerialKillerBypassGadgetCollection/blob/master/src/main/java/serialkiller/bypass/Beanutils1.java
	-> Bypass blacklist filter
	-> Profit :) 
	
OPTION 2:
	- Build payload with SerializableRenderedImage from Oracle's jai_core.jar to bypass the blacklist.
	- Profit :) 
	
OPTION 3: (Most unsure)
	- Use JRMPClient and pumps JRMPServer to 1099?
	- Profit?
	
